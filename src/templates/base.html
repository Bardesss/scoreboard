<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="light dark">
    <meta name="theme-color" content="#5c6bc0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Scoreboard</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <!-- Critical CSS loading -->
    <link rel="stylesheet" href="/static/custom.css">
    <link href="/static/vendor/material-design/material-design.css" rel="stylesheet">
    <link href="/static/vendor/material-design/icons.css" rel="stylesheet">
</head>
<body>
    <div class="mdc-layout">
        <header class="mdc-top-app-bar">
            <div class="mdc-top-app-bar__row">
                <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                    <a href="/" class="mdc-top-app-bar__title">♟️ Scoreboard</a>
                    {% if request.session.get('is_admin') %}
                    <nav class="mdc-top-app-bar__navigation desktop-nav">
                        <a href="/admin/players" class="mdc-button mdc-button--text{% if '/admin/players' in request.url.path %} mdc-button--selected{% endif %}">Players</a>
                        <a href="/admin/boardgames" class="mdc-button mdc-button--text{% if '/admin/boardgames' in request.url.path %} mdc-button--selected{% endif %}">Boardgames</a>
                        <a href="/admin/tasks" class="mdc-button mdc-button--text{% if '/admin/tasks' in request.url.path %} mdc-button--selected{% endif %}">Tasks</a>
                        <a href="/admin/societies" class="mdc-button mdc-button--text{% if '/admin/societies' in request.url.path %} mdc-button--selected{% endif %}">Societies</a>
                    </nav>
                    {% endif %}
                </section>
                <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end">
                    <div class="mdc-top-app-bar__actions desktop-actions">
                        <button class="theme-switcher" id="theme-switcher" title="Toggle theme">
                            <i class="bi bi-sun-fill"></i>
                        </button>
                        {% if request.session.get('user_id') %}
                            <a href="/logout" class="mdc-button mdc-button--outlined">Logout</a>
                        {% else %}
                            <a href="/login" class="mdc-button mdc-button--outlined">Login</a>
                        {% endif %}
                    </div>
                    {% if request.session.get('is_admin') %}
                    <button class="mdc-button mdc-button--text mobile-menu-toggle" id="mobile-menu-toggle">
                        <i class="bi bi-list"></i>
                    </button>
                    {% endif %}
                </section>
            </div>
        </header>
        
        <!-- Mobile menu overlay -->
        {% if request.session.get('is_admin') %}
        <div class="mobile-menu-overlay" id="mobile-menu-overlay">
                            <div class="mobile-menu">
                    <div class="mobile-menu-header">
                        <h3>Menu</h3>
                    </div>
                    <nav class="mobile-menu-nav">
                    <a href="/" class="mobile-menu-item{% if request.url.path == '/' %} mobile-menu-item--selected{% endif %}">
                        Home
                    </a>
                    <a href="/admin/players" class="mobile-menu-item{% if '/admin/players' in request.url.path %} mobile-menu-item--selected{% endif %}">
                        Players
                    </a>
                    <a href="/admin/boardgames" class="mobile-menu-item{% if '/admin/boardgames' in request.url.path %} mobile-menu-item--selected{% endif %}">
                        Boardgames
                    </a>
                    <a href="/admin/tasks" class="mobile-menu-item{% if '/admin/tasks' in request.url.path %} mobile-menu-item--selected{% endif %}">
                        Tasks
                    </a>
                    <a href="/admin/societies" class="mobile-menu-item{% if '/admin/societies' in request.url.path %} mobile-menu-item--selected{% endif %}">
                        Societies
                    </a>
                </nav>
                <div class="mobile-menu-footer">
                    {% if request.session.get('user_id') %}
                        <a href="/logout" class="mobile-menu-item mobile-menu-item--logout">Logout</a>
                    {% else %}
                        <a href="/login" class="mobile-menu-item mobile-menu-item--login">Login</a>
                    {% endif %}
                    <div class="mobile-menu-actions">
                        <button class="theme-switcher mobile-theme-switcher" id="mobile-theme-switcher" title="Toggle theme">
                            <i class="bi bi-sun-fill"></i>
                        </button>
                        <button class="mobile-menu-close" id="mobile-menu-close">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <main class="mdc-layout__content">
            <div class="mdc-container">
                {% block content %}{% endblock %}
            </div>
        </main>
        
        <footer class="mdc-footer">
            <div class="mdc-container mdc-text-center">
                <span class="mdc-footer__text">Want to contribute? <a href="https://github.com/Bardesss/scoreboard" target="_blank">Check out our GitHub repository</a> | <a href="https://github.com/Bardesss/scoreboard/blob/main/LICENSE" target="_blank">MIT License</a></span>
            </div>
        </footer>
    </div>
    
    <script>
        // Apply theme immediately to prevent flash
        (function() {
            const storedTheme = localStorage.getItem('theme');
            const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const theme = storedTheme || systemTheme;
            document.documentElement.setAttribute('data-theme', theme);
            
            // Force CSS reload on mobile if needed
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                // Ensure CSS is properly loaded on mobile
                const styleSheets = document.styleSheets;
                for (let i = 0; i < styleSheets.length; i++) {
                    try {
                        const rules = styleSheets[i].cssRules || styleSheets[i].rules;
                        if (rules && rules.length > 0) {
                            // CSS is loaded, force a repaint
                            document.body.style.display = 'none';
                            document.body.offsetHeight; // Force reflow
                            document.body.style.display = '';
                        }
                    } catch (e) {
                        // Cross-origin stylesheet, skip
                    }
                }
            }
        })();
        
        // Theme management
        class ThemeManager {
            constructor() {
                this.themeSwitcher = document.getElementById('theme-switcher');
                this.mobileThemeSwitcher = document.getElementById('mobile-theme-switcher');
                this.currentTheme = this.getStoredTheme() || this.getSystemTheme();
                this.init();
            }

            getStoredTheme() {
                return localStorage.getItem('theme');
            }

            getSystemTheme() {
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            setTheme(theme) {
                this.currentTheme = theme;
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                this.updateThemeSwitcher();
            }

            updateThemeSwitcher() {
                const switchers = [this.themeSwitcher, this.mobileThemeSwitcher];
                switchers.forEach(switcher => {
                    if (switcher) {
                        const icon = switcher.querySelector('i');
                        if (this.currentTheme === 'dark') {
                            // Bij donker thema: toon zon icoon (om naar licht te gaan)
                            icon.className = 'bi bi-sun-fill';
                            switcher.setAttribute('data-theme', 'dark');
                        } else {
                            // Bij licht thema: toon maan icoon (om naar donker te gaan)
                            icon.className = 'bi bi-moon-fill';
                            switcher.removeAttribute('data-theme');
                        }
                    }
                });
            }

            toggleTheme() {
                const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(newTheme);
            }

            init() {
                this.setTheme(this.currentTheme);
                
                const switchers = [this.themeSwitcher, this.mobileThemeSwitcher];
                switchers.forEach(switcher => {
                    if (switcher) {
                        switcher.addEventListener('click', () => this.toggleTheme());
                    }
                });

                // Listen for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (!this.getStoredTheme()) {
                        this.setTheme(e.matches ? 'dark' : 'light');
                    }
                });
            }
        }

        // Simple Material Design interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme manager
            new ThemeManager();
            
            // Mobile menu functionality
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const mobileMenuClose = document.getElementById('mobile-menu-close');
            
            if (mobileMenuToggle && mobileMenuOverlay) {
                mobileMenuToggle.addEventListener('click', function() {
                    mobileMenuOverlay.classList.add('mobile-menu-overlay--open');
                    document.body.style.overflow = 'hidden';
                });
                
                mobileMenuClose.addEventListener('click', function() {
                    mobileMenuOverlay.classList.remove('mobile-menu-overlay--open');
                    document.body.style.overflow = '';
                });
                
                mobileMenuOverlay.addEventListener('click', function(e) {
                    if (e.target === mobileMenuOverlay) {
                        mobileMenuOverlay.classList.remove('mobile-menu-overlay--open');
                        document.body.style.overflow = '';
                    }
                });
                
                // Close menu on escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && mobileMenuOverlay.classList.contains('mobile-menu-overlay--open')) {
                        mobileMenuOverlay.classList.remove('mobile-menu-overlay--open');
                        document.body.style.overflow = '';
                    }
                });
            }
            
            // Text field focus effects
            const textFields = document.querySelectorAll('.mdc-text-field');
            textFields.forEach(field => {
                const input = field.querySelector('.mdc-text-field__input');
                const label = field.querySelector('.mdc-text-field__label');
                
                if (input && label) {
                    input.addEventListener('focus', () => {
                        field.classList.add('mdc-text-field--focused');
                        field.classList.add('mdc-text-field--label-floating');
                    });
                    
                    input.addEventListener('blur', () => {
                        field.classList.remove('mdc-text-field--focused');
                        if (!input.value) {
                            field.classList.remove('mdc-text-field--label-floating');
                        }
                    });
                    
                    // Check if input has value on load
                    if (input.value) {
                        field.classList.add('mdc-text-field--label-floating');
                    }
                }
            });
            
            // Button ripple effect
            const buttons = document.querySelectorAll('.mdc-button');
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    const ripple = document.createElement('span');
                    ripple.classList.add('mdc-ripple');
                    ripple.style.position = 'absolute';
                    ripple.style.borderRadius = '50%';
                    ripple.style.transform = 'scale(0)';
                    ripple.style.animation = 'ripple 0.6s linear';
                    ripple.style.left = (e.clientX - button.offsetLeft) + 'px';
                    ripple.style.top = (e.clientY - button.offsetTop) + 'px';
                    ripple.style.width = ripple.style.height = '20px';
                    ripple.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
                    
                    button.style.position = 'relative';
                    button.style.overflow = 'hidden';
                    button.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });
        });
        
        // Add ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 