{% extends 'base.html' %}
{% block content %}
<div class="mdc-card mb-4">
  <div class="mdc-card__content">
    <h2 class="mdc-typography--headline5 mb-4">Societies</h2>
    <div class="mdc-data-table">
      <table class="mdc-data-table__table">
        <thead class="mdc-data-table__header-row">
          <tr>
            <th class="mdc-data-table__header-cell">Name</th>
            <th class="mdc-data-table__header-cell">Players</th>
            <th class="mdc-data-table__header-cell text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="mdc-data-table__content">
          {% for society in societies %}
          <tr class="mdc-data-table__row">
            <td class="mdc-data-table__cell">{{ society.name }}</td>
            <td class="mdc-data-table__cell">
              {% set player_ids = society.player_ids.split(',') %}
              {% set society_players = [] %}
              {% for player in players %}
                {% if player.id|string in player_ids %}
                  {% set _ = society_players.append(player.name) %}
                {% endif %}
              {% endfor %}
              {% set society_players = society_players|sort %}
              {{ society_players | join(', ') }}
            </td>
            <td class="mdc-data-table__cell text-right">
              <div class="btn-group" role="group">
                {% if request.session.get('is_admin') or (request.session.get('user_id') and society.created_by_user_id and society.created_by_user_id == request.session.get('user_id')) %}
                <a href="/societies/{{ society.id }}/games/add" class="mdc-button mdc-button--text" title="Add Game">
                  <i class="bi bi-plus-circle"></i>
                </a>
                {% endif %}
                <a href="/societies/{{ society.id }}/games" class="mdc-button mdc-button--text" title="View Games">
                  <i class="bi bi-eye"></i>
                </a>
                <a href="/societies/{{ society.id }}/stats" class="mdc-button mdc-button--text" title="Statistics">
                  <i class="bi bi-graph-up"></i>
                </a>
              </div>
            </td>
          </tr>
          {% else %}
          <tr class="mdc-data-table__row">
            <td class="mdc-data-table__cell" colspan="3">No societies found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <h2 class="mdc-typography--headline5 mb-4 mt-5">Recent Played Games</h2>
    <div class="mdc-data-table">
      <table class="mdc-data-table__table">
        <thead class="mdc-data-table__header-row">
          <tr>
            <th class="mdc-data-table__header-cell">Date</th>
            <th class="mdc-data-table__header-cell">Society</th>
            <th class="mdc-data-table__header-cell">Board Game</th>
            <th class="mdc-data-table__header-cell">Winner</th>
          </tr>
        </thead>
        <tbody class="mdc-data-table__content">
          {% for game in played_games %}
          <tr class="mdc-data-table__row">
            <td class="mdc-data-table__cell">{{ game.played_at.strftime('%d/%m/%Y %H:%M') }}</td>
            <td class="mdc-data-table__cell">
              {% for s in societies %}{% if s.id == game.society_id %}{{ s.name }}{% endif %}{% endfor %}
            </td>
            <td class="mdc-data-table__cell">
              {% for g in games %}{% if g.id == game.boardgame_id %}{{ g.name }}{% endif %}{% endfor %}
            </td>
            <td class="mdc-data-table__cell">
              {% set winner_id = game.winner_id if game.winner_id else game.winner_id_task %}
              {% if winner_id %}
                {% for p in players %}
                  {% if p.id == winner_id %}
                    {{ p.name }}
                  {% endif %}
                {% endfor %}
              {% else %}
                -
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %} 